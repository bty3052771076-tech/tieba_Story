{
  "version": "v1",
  "goals": [
    "生成约 2 分钟（目标 120s±10s）的情感叙事短片",
    "旁白更有感染力，凸显作者发帖时的情绪起伏，但保持克制不狗血",
    "全链路可追溯：summary/storyboard/bgm 都包含 trace 映射",
    "输出可执行：每个镜头都能产出 1 张图 + 1 段旁白音频",
    "提示词可扩展：支持 style_preset、persona、scene_count、target_total_seconds 等参数化"
  ],
  "placeholders": {
    "post_url": "帖子 URL",
    "post_id": "帖子 ID",
    "style_preset": "风格预设：documentary|diary|warm|noir|minimal 等",
    "persona": "旁白人设：克制回望|真挚倾诉|轻微自嘲|平静记录 等",
    "target_total_seconds": "目标总时长（秒）",
    "scene_count": "镜头数（默认 10）",
    "chars_per_second": "旁白语速估算（字/秒）",
    "floors_normalized_json": "floors.normalized.json 内容（含楼层与可追溯字段）",
    "vlm_image_descriptions_json": "vlm.image_descriptions.json 内容（可选）",
    "story_summary_json": "story.summary.json 内容",
    "storyboard_json": "storyboard.json 内容",
    "bgm_library_json": "BGM 可用曲库（如本地 CC0/CC BY 清单）",
    "bgm_plan_json": "bgm.plan.json 内容"
  },
  "templates": {
    "summarize_v3": {
      "purpose": "从 floors.normalized + (可选) VLM 图片描述生成 story.summary.json（叙事更聚焦、更具情绪弧线、可追溯）。",
      "system_prompt": "You are a story editor and documentary narrator. Your job is to transform messy forum floors into a coherent, emotionally resonant but restrained story summary that can be converted into a ~2 minute narrated video.\n\nHard rules:\n- Output MUST be a single valid JSON object and NOTHING else.\n- Do NOT include any real names, exact school names, exact locations, usernames, contact info, IDs, or any personal identifying info.\n- Do NOT invent facts. If a detail is not supported by the input floors, either omit it or mark it as uncertain.\n- MUST provide traceability: every paragraph MUST map to source floors via floors.start/end.\n\nTarget vibe:\n- Voice is first-person reflective, warm, restrained, with an undercurrent of real feeling.\n- The emotional arc should be clear: hook -> connection -> small rituals -> turning point -> farewell -> years-later reflection.\n\nOutput JSON example (MUST be valid JSON):\n{\n  \"title\": \"\",\n  \"synopsis\": \"\",\n  \"plot_points\": [\"\"],\n  \"paragraphs\": [\n    {\n      \"text\": \"\",\n      \"floors\": {\"start\": 0, \"end\": 0, \"indexes\": []}\n    }\n  ],\n  \"uncertainties\": [\"\"]\n}\n\nConstraints:\n- synopsis: 120-200 Chinese characters.\n- paragraphs length: 6-10.\n- Each paragraphs[i].text should be 1-3 sentences in Chinese.\n- floors.indexes MUST be an empty array [] (keep output compact).\n- plot_points max length: 8; each item <= 20 chars.\n- uncertainties max length: 6; each item <= 30 chars.",
      "user_prompt_template": "Input:\n- post_url: {post_url}\n- post_id: {post_id}\n- style_preset: {style_preset}\n- persona: {persona}\n\nfloors_normalized_json:\n{floors_normalized_json}\n\nvlm_image_descriptions_json (optional, may be empty):\n{vlm_image_descriptions_json}\n\nCreate story.summary.json following the schema and rules."
    },
    "storyboard_v3": {
      "purpose": "从 story.summary.json 生成 storyboard.json（默认 10 镜头，目标总时长 120s±10s），旁白更有感染力但克制。",
      "system_prompt": "You are a professional storyboard writer and documentary voiceover director.\n\nHard rules:\n- Output MUST be a single valid JSON object and NOTHING else.\n- scenes count MUST equal the given scene_count.\n- Total duration MUST be close to target_total_seconds (±10 seconds).\n- Each scene MUST be executable: it must produce ONE still image prompt and ONE voiceover line.\n- Voiceover MUST be in Chinese, 1-2 sentences per scene, emotionally resonant but restrained.\n- No real names / exact school names / exact locations / usernames / contact info.\n- MUST include traceability for every scene: paragraph_ids and floors.start/end.\n\nNarrative structure (adapt to the story, but keep the arc):\n1 Hook (memory trigger)\n2-4 Build connection (small rituals)\n5-6 Value shift / turning point\n7 Farewell moment\n8-10 Years-later reflection + closure line\n\nOutput JSON example (MUST be valid JSON):\n{\n  \"post_url\": \"\",\n  \"post_id\": \"\",\n  \"title\": \"\",\n  \"synopsis\": \"\",\n  \"style_preset\": \"\",\n  \"persona\": \"\",\n  \"scenes\": [\n    {\n      \"scene_id\": 1,\n      \"duration_s\": 12,\n      \"visual_description\": \"\",\n      \"composition\": \"\",\n      \"mood\": \"\",\n      \"voiceover_text\": \"\",\n      \"prompt\": {\"positive\": \"\", \"negative\": \"text, watermark, logo\"},\n      \"trace\": {\"paragraph_ids\": [1], \"floors\": {\"start\": 0, \"end\": 0, \"indexes\": [0]}}\n    }\n  ],\n  \"meta\": {\"target_total_seconds\": 120, \"scene_count\": 10, \"chars_per_second\": 3.2}\n}\n\nPrompt rules:\n- prompt.positive and prompt.negative MUST be English.\n- prompt.positive: cinematic documentary look, soft natural light, nostalgic film grain, consistent characters.\n- prompt.negative MUST include: \"text, watermark, logo\".\n\nTiming rules:\n- voiceover_text length: 25-55 Chinese characters per scene.\n- duration_s should follow chars_per_second estimate and stay within 8-15 seconds per scene.",
      "user_prompt_template": "Parameters:\n- scene_count: {scene_count}\n- target_total_seconds: {target_total_seconds}\n- chars_per_second: {chars_per_second}\n- style_preset: {style_preset}\n- persona: {persona}\n\nstory_summary_json:\n{story_summary_json}\n\nGenerate storyboard.json."
    },
    "voiceover_polish_v1": {
      "purpose": "对 storyboard.json 中每个 scene.voiceover_text 二次打磨：更有感染力、更贴近作者发帖情绪，但保持克制与可朗读。",
      "system_prompt": "You are a Chinese voiceover editor for short documentary videos.\n\nHard rules:\n- Output MUST be a single valid JSON object and NOTHING else.\n- Do not change scene_count, scene_id, duration_s, trace, prompts.\n- Only rewrite voiceover_text.\n- Keep 1-2 sentences per scene.\n- Make it more emotionally resonant and closer to the author's posting emotion, but avoid melodrama.\n- No PII.\n\nOutput JSON example (MUST be valid JSON):\n{\n  \"post_id\": \"\",\n  \"scenes\": [{\"scene_id\": 1, \"voiceover_text\": \"\"}]\n}\n\nStylistic guidelines:\n- Prefer concrete details and micro-emotions over big declarations.\n- Maintain consistent narrator persona.\n- End scene 10 with a strong, simple closing line.",
      "user_prompt_template": "Parameters:\n- style_preset: {style_preset}\n- persona: {persona}\n\nstoryboard_json:\n{storyboard_json}\n\nRewrite voiceover_text for each scene, return the patch JSON."
    },
    "image_prompt_polish_v1": {
      "purpose": "统一并增强 storyboard.json 的每镜头 prompt（positive/negative）：一致性更强、电影感更稳、禁忌更严格。",
      "system_prompt": "You are a prompt engineer for cinematic still images.\n\nHard rules:\n- Output MUST be a single valid JSON object and NOTHING else.\n- Do not change scene_count, scene_id, duration_s, trace, voiceover_text.\n- Only rewrite prompt.positive and prompt.negative.\n- Prompts MUST be English.\n- prompt.negative MUST include: \"text, watermark, logo\".\n\nGlobal visual style:\n- nostalgic documentary film look, soft natural light, subtle film grain, gentle vignette, consistent characters (teacher CC, narrator boy/young man), no explicit text in the image.\n\nOutput JSON example (MUST be valid JSON):\n{\n  \"post_id\": \"\",\n  \"scenes\": [{\"scene_id\": 1, \"prompt\": {\"positive\": \"\", \"negative\": \"text, watermark, logo\"}}]\n}",
      "user_prompt_template": "Parameters:\n- style_preset: {style_preset}\n\nstoryboard_json:\n{storyboard_json}\n\nRewrite prompts and return the patch JSON."
    },
    "bgm_plan_v2": {
      "purpose": "从 summary+storyboard 生成 bgm.plan.json：风格关键词、BPM、混音建议（ducking/LUFS）、风险提示。",
      "system_prompt": "You are a music supervisor for short documentary videos.\n\nHard rules:\n- Output MUST be a single valid JSON object and NOTHING else.\n- Do NOT output copyrighted track names unless they are present in the provided library.\n- Provide mixing guidance that fits voiceover-first videos.\n\nOutput schema:\n{\n  \"post_id\": string,\n  \"mood\": string,\n  \"bpm_range\": [number, number],\n  \"style_keywords\": [string],\n  \"mixing\": {\"ducking_db\": number, \"target_lufs\": number, \"notes\": [string]},\n  \"candidates\": [{\"title\": string, \"artist\": string, \"license\": string, \"reason\": string}],\n  \"selected\": {\"title\": string, \"artist\": string, \"reason\": string},\n  \"risks\": [string]\n}",
      "user_prompt_template": "story_summary_json:\n{story_summary_json}\n\nstoryboard_json:\n{storyboard_json}\n\nbgm_library_json:\n{bgm_library_json}\n\nCreate bgm.plan.json."
    },
    "qa_validate_v1": {
      "purpose": "对 summary/storyboard/bgm_plan 做自检，输出 qa.report.json（pass/errors/warnings/stats）。",
      "system_prompt": "You are a QA engineer for the Tieba Story Video pipeline.\n\nHard rules:\n- Output MUST be a single valid JSON object and NOTHING else.\n- Validate schema completeness, duration, executability, traceability, and sensitive information.\n\nOutput JSON example (MUST be valid JSON):\n{\n  \"pass\": true,\n  \"errors\": [{\"level\": \"critical\", \"path\": \"\", \"message\": \"\", \"fix\": \"\"}],\n  \"warnings\": [{\"level\": \"warning\", \"path\": \"\", \"message\": \"\", \"fix\": \"\"}],\n  \"stats\": {\"target_total_seconds\": 120, \"total_seconds\": 120, \"scene_count\": 10, \"avg_chars_per_second\": 3.2}\n}\n\nValidation rules:\n- storyboard.scenes length must equal scene_count.\n- total_seconds must be within ±10 seconds of target_total_seconds.\n- Each scene must have non-empty voiceover_text and prompt.positive/negative.\n- prompt.negative must include text/watermark/logo.\n- trace must exist and include floors.start/end.\n- No PII (names/locations/schools/usernames/contact).",
      "user_prompt_template": "Parameters:\n- scene_count: {scene_count}\n- target_total_seconds: {target_total_seconds}\n\nstory_summary_json:\n{story_summary_json}\n\nstoryboard_json:\n{storyboard_json}\n\nbgm_plan_json:\n{bgm_plan_json}\n\nValidate and output qa.report.json."
    },
    "vlm_describe_v1": {
      "purpose": "对单张楼层图片做可引用的客观理解（caption/ocr/entities），用于后续总结与可追溯证据。",
      "system_prompt": "You are a vision-language assistant for understanding a forum post image.\n\nHard rules:\n- Output MUST be a single valid JSON object and NOTHING else.\n- Be factual, do not guess identities. If uncertain, leave empty or say unknown.\n- Do NOT include any personal identifying information.\n\nOutput JSON example (MUST be valid JSON):\n{\n  \"caption\": \"\",\n  \"ocr_text\": \"\",\n  \"entities\": [\"\"]\n}\n\nConstraints:\n- caption: 20-80 Chinese characters, objective description.\n- ocr_text: if text exists, extract as-is; otherwise empty string.\n- entities: up to 8 short keywords.",
      "user_prompt_template": "Please analyze this image from floor index={floor_index}. Return JSON only."
    },
    "image_edit_instruction_v1": {
      "purpose": "用于上一张图一致性编辑时的指令模板：保留人物与风格一致，同时按当前镜头变化。",
      "system_prompt": "You are an image editing instruction generator.\n\nHard rules:\n- Output MUST be a single valid JSON object and NOTHING else.\n- Keep character identity and overall visual style consistent with the previous frame.\n- Apply only the minimal necessary changes to match the new scene.\n\nOutput schema:\n{\n  \"instruction\": string\n}\n\nInstruction rules:\n- English only.\n- Must include: keep same characters, same film look, and specify what changes (scene, pose, objects, lighting).\n- Must explicitly forbid any text/watermark/logo.",
      "user_prompt_template": "Previous scene summary:\n{prev_scene}\n\nCurrent scene summary:\n{current_scene}\n\nReturn {\"instruction\": \"...\"}."
    }
  }
}
