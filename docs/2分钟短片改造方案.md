# 2 分钟短片改造方案（先改提示词，后改代码）

## 目标
- 产出 **约 2 分钟（120s±10s）** 的完整短片（图片+旁白+BGM+字幕）。
- 旁白更有感染力，凸显作者发帖时的情绪，但整体保持克制与纪实感。
- 本轮先完成“提示词体系”与“可扩展性设计”的文件落盘；你确认后我再修改代码与跑全量渲染。

## 核心策略：提示词体系化
本项目的关键并不是“某一句提示词更好”，而是把提示词拆成可组合、可版本化的模板集：
- Summary：把楼层整理成结构化段落（可追溯）
- Storyboard：固定镜头数与总时长，生成“可执行镜头”（可追溯）
- Voiceover Polish：二次润色旁白，让情绪更贴近作者
- Image Prompt Polish：统一画风与禁忌，提高一致性
- BGM Plan：声场优先级（旁白第一），给出 ducking/LUFS 等混音建议
- QA Validate：自动自检，尽量在生成前发现问题

模板统一落盘在：[prompt_pack.json](file:///d:/AI/trae/tieba_story/prompts/packs/v1/prompt_pack.json)

## 叙事与节奏规格（用于 storyboard 提示词）
- 场景数：默认 10（可参数化）
- 结构：Hook(1) → 建立关系(2-4) → 转折/价值观(5-6) → 离别(7) → 多年后回望(8-10)
- 单镜头旁白：1–2 句为主，25–55 字（通过 chars_per_second 估算时长）
- 结尾：收束有力、简洁、余韵长（避免口号式煽情）

## 视觉规格（用于 image prompt 提示词）
- 纪实电影感：柔和自然光、轻胶片颗粒、轻暗角
- 统一人物：老师 CC、叙述者（少年/成年），不出现具体地名/学校名/真实姓名
- 禁忌：任何画面文字、Logo、水印（negative 必含 text/watermark/logo）

## 音频规格（用于 bgm plan 提示词）
- 旁白优先：全片 ducking，旁白出现时压低 BGM（例如 -6dB 至 -12dB 范围）
- 目标响度：给出建议 LUFS（例如 -16 LUFS 左右，按平台可调）

## 字幕规格（对齐你目前的要求）
- 尽量单行
- 去除逗号、句号（渲染阶段统一清洗）

## 可扩展性设计（你确认后我再落地到代码）
### 1) Prompt Pack 版本化
- `prompts/packs/{version}/prompt_pack.json`
- 通过 `--prompt-pack v1` 或配置文件选择版本

### 2) 风格预设与旁白人设
- `style_preset`：documentary / diary / warm / noir / minimal
- `persona`：克制回望 / 真挚倾诉 / 轻微自嘲 / 平静记录
- 作为参数传入模板，避免“改一次提示词影响全项目”

### 3) 产物与验证
- 每次生成都把：prompt_pack_version、参数（scene_count/target_total_seconds/cps）写入产物 meta
- 新增 `qa.report.json`，失败则阻断后续步骤

## 你确认前我不会改的东西
- 不修改 `tools/` 里的提示词实现（只先写模板文件）
- 不修改 Remotion 合成逻辑
- 不触发全量重渲染

## 你确认后我将做的代码改动（预告）
- 将 `tools/tieba_m2_summarize.py`、`tools/tieba_m3_storyboard.py`、`tools/tieba_m5_bgm_plan.py` 的内嵌 sys_prompt/user_prompt 改为从 prompt_pack.json 加载
- 增加命令行参数：`--prompt-pack`、`--style-preset`、`--persona`、`--target-seconds`
- 增加“二次润色”步骤：voiceover_polish、image_prompt_polish，并写入版本号与 patch 记录
- 最后用 QA 模板做自检，再跑 9461449190 全量 2 分钟视频输出

